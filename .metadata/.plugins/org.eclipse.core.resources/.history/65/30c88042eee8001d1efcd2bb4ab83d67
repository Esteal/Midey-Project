package fr.midey.MagicUHC.Magie.Eau;

import org.bukkit.Bukkit;
import org.bukkit.Location;
import org.bukkit.Material;
import org.bukkit.World;
import org.bukkit.entity.Player;
import org.bukkit.event.EventHandler;
import org.bukkit.event.Listener;
import org.bukkit.event.player.PlayerInteractEvent;
import org.bukkit.inventory.ItemStack;
import org.bukkit.util.Vector;

import fr.midey.MagicUHC.MagicUHC;
import fr.midey.MagicUHC.Nature;

public class Geyser implements Listener {

	private MagicUHC main;
	
	public Geyser(MagicUHC main) {
		this.main = main;
	}
	
	@EventHandler
	public void onTsunami(PlayerInteractEvent e) {
		ItemStack it = e.getItem();
		if(it == null) return;
		//if(!main.game) return;
		Player p = e.getPlayer();
		if(main.getPlayerNature().get(p).equals(Nature.Eau)) {
			if(it.hasItemMeta() && it.getItemMeta().hasDisplayName() &&it.getItemMeta().getDisplayName().equalsIgnoreCase("§9Geyser") && it.getType().equals(Material.NETHER_STAR)) {
				Location ploc = p.getLocation();
				World world = ploc.getWorld();
				Vector v = ploc.getDirection();
				v.multiply(2);
				Location newLoc = v.toLocation(world);
				WaterCooldown cd = new WaterCooldown();
				cd.cooldown = 10;
				cd.task = Bukkit.getScheduler().runTaskTimer(main, () -> {
					if(newLoc.getBlock().getType() == Material.AIR) {
						world.getBlockAt(newLoc).setType(Material.WATER);
					}
					newLoc.setY(1);
					cd.cooldown--;
					if(cd.cooldown <= 0) cd.task.cancel();
				}, 0, 5);
				Bukkit.getScheduler().runTaskLater(main, () -> {
					for(int i = 10; i>0; i++) {
						if(newLoc.getBlock().getType() == Material.WATER) {
							world.getBlockAt(newLoc).setType(Material.AIR);	
						}
						newLoc.setY(-1);
					}
				}, 50);
			}
		}
	}
}
